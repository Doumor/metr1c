# metr1c
Утилита для сбора метрик из 1С rac для Prometheus.

В данный момент собирает только информацию об активных сессиях (читать используемых пользовательских лицензиях).

## Roadmap

```
+ 0.0.1 : Первый релиз.
0.1.0 : Добавить службу systemd.
0.2.0 : Добавить ansible роль. (Будет в отдельном репозитории)
...
? : Уменьшить исполняемый файл максимально насколько возможно. Сейчас (0.0.1) он весит 7 мегабайт, что много.
? : Привести структуру проекта ближе к стандарту, разделить на части.
...
1.0.0 : metric выдаёт всю информацию 1С rac и позволяет конфигурировать то, что нужно отправлять через конфиг/переменные окружения в службе. Установка в /opt через роль или скрипт. Проверено и работает на проде.
...
? : Порт на Windows (А нужно ли?) / инструкции по сборке для Windows и использованию.
? : Отдельный проект / дополнительный функционал (Какой?) через расширение информационной базы. Текущие проекты, которые я видел не были безопасны.
? : Сборка для ALT Linux Сизиф (А это точно нужно внутри диструбтива?)
```

## Как собрать?
```
$ make build
```

Выходной файл - metr1c

## Как использовать?

На сервере должен работать 1С ras (systemctl link /path/to/1c/ras-...). В env запущенного metr1c нужно добавить следующие переменные:
```
platform1c_admin_cluster : uuid кластера
platform1c_admin_user    : Имя админа кластера
platform1c_admin_pw      : Пароль админа кластера
platform1c_version       : Версия платформы 1С
```
Сделать это можно в bash через export:
```
$ export platform1c_admin_user=Администратор
...
```


Информацию выдаёт на порт :1599 в /metric. Службы systemd пока нет.

## Безопасность

Пароль и имя админа передаются в rac как аргументы и при установленном hidepid=0 другие пользователи на сервере смогут их увидеть. Рекомендуеться установить hidepid=1.

## Авторство
Лицензия - GPLv3.

Если интересует совместная разработка или проект в целом, то почта для связи - doumor@vk.com
